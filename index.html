<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Entretien du centre de secours de Consenvoye</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121826;
      --text:#e8eef7;
      --muted:#a7b2c5;
      --red:#d72638;
      --red2:#ff3b30;
      --line: rgba(255,255,255,.10);
      --shadow: 0 14px 40px rgba(0,0,0,.45);
      --radius: 18px;
      --ok:#2ecc71;
      --warn:#ffb020;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      min-height:100vh;
      background:
        radial-gradient(1200px 600px at 20% -10%, rgba(215,38,56,.30), transparent 60%),
        radial-gradient(900px 500px at 95% 15%, rgba(255,59,48,.12), transparent 55%),
        linear-gradient(180deg, #070a0f, #0b0f14 40%, #070a0f);
    }
    .wrap{ max-width: 980px; margin: 0 auto; padding: 18px 14px 28px; }

    .hero{
      background:
        linear-gradient(135deg, rgba(215,38,56,.18), rgba(18,24,38,.92) 55%),
        linear-gradient(180deg, rgba(255,255,255,.06), transparent 35%);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      padding: 18px 16px;
      box-shadow: var(--shadow);
      position: relative;
      overflow: hidden;
    }
    .hero::after{
      content:"";
      position:absolute;
      inset:-60px -80px auto auto;
      width: 260px; height: 260px;
      background: radial-gradient(circle at 30% 30%, rgba(255,59,48,.50), rgba(255,59,48,0) 65%);
      transform: rotate(18deg);
      opacity:.9;
      pointer-events:none;
    }
    .brand{ display:flex; gap:12px; align-items:center; }
    .logo{
      width: 46px; height: 46px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(215,38,56,.95), rgba(255,59,48,.65));
      box-shadow: 0 10px 24px rgba(215,38,56,.22);
      display:grid; place-items:center;
      border: 1px solid rgba(255,255,255,.18);
      flex:0 0 auto;
    }
    .title{ margin:0; font-size:22px; letter-spacing:.2px; line-height:1.08; }
    .subtitle{ margin:6px 0 0; color:var(--muted); font-size:13px; }

    .card{
      margin-top: 14px;
      background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardBody{ padding: 14px; }

    .row{ display:grid; grid-template-columns: 1fr; gap: 12px; }
    @media(min-width: 520px){ .row.two{ grid-template-columns: 1fr 1fr; } }

    label{ display:block; font-size:12px; color: var(--muted); margin-bottom:6px; }
    select, input, textarea{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(15,21,34,.55);
      color: var(--text);
      outline: none;
      font-size: 16px;
    }
    textarea{ min-height: 110px; resize: vertical; }

    select:focus, input:focus, textarea:focus{
      border-color: rgba(255,59,48,.55);
      box-shadow: 0 0 0 4px rgba(215,38,56,.15);
    }

    .tabs{
      display:flex; gap:10px; padding:10px;
      background: rgba(15,21,34,.40);
      border-top: 1px solid var(--line);
      border-bottom: 1px solid var(--line);
    }
    .tab{
      flex:1;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      padding: 12px 10px;
      border-radius: 14px;
      cursor:pointer;
      font-weight: 800;
      font-size: 14px;
      display:flex; align-items:center; justify-content:center; gap:8px;
      user-select:none;
      transition: transform .08s ease, background .15s ease, border-color .15s ease;
    }
    .tab:active{ transform: scale(.99); }
    .tab.active{
      background: linear-gradient(135deg, rgba(215,38,56,.18), rgba(255,59,48,.08));
      border-color: rgba(255,59,48,.55);
      box-shadow: 0 10px 22px rgba(215,38,56,.10);
    }

    .content{ display:none; padding: 14px; }
    .content.active{ display:block; }

    .section{
      border: 1px solid var(--line);
      border-radius: 16px;
      padding: 12px;
      background: rgba(15,21,34,.35);
    }
    .sectionTitle{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      margin:0 0 10px 0;
      font-size: 13px;
      letter-spacing: .3px;
      text-transform: uppercase;
      color: var(--muted);
      font-weight: 800;
    }
    .btn{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.14);
      background: linear-gradient(135deg, rgba(215,38,56,.95), rgba(255,59,48,.78));
      color: white;
      font-weight: 900;
      cursor:pointer;
      font-size: 16px;
      box-shadow: 0 12px 28px rgba(215,38,56,.20);
      transition: transform .08s ease, filter .15s ease;
    }
    .btn:active{ transform: scale(.99); }
    .btn:hover{ filter: brightness(1.05); }

    .btnGhost{
      width:100%;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
      color: var(--text);
      font-weight: 800;
      cursor:pointer;
    }

    .inlineBtns{ display:flex; gap:10px; }
    .inlineBtns > *{ flex:1; }

    .list{
      margin: 10px 0 0 0;
      padding: 0;
      list-style: none;
      display:flex;
      flex-direction: column;
      gap:8px;
    }
    .item{
      display:flex;
      justify-content: space-between;
      align-items:center;
      gap:10px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.04);
    }
    .item span{ font-weight: 700; }
    .smallBtn{
      padding: 8px 10px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: var(--text);
      cursor:pointer;
      font-weight: 800;
      font-size: 13px;
      white-space: nowrap;
    }
    .smallBtn.danger{
      border-color: rgba(255,59,48,.35);
      background: rgba(255,59,48,.10);
    }

    .hint{
      margin: 10px 0 0 0;
      font-size: 12px;
      color: rgba(255,255,255,.55);
      line-height: 1.35;
    }

    .lockRow{ display:grid; grid-template-columns: 1fr auto; gap: 10px; align-items:center; }
    @media(max-width:420px){ .lockRow{ grid-template-columns: 1fr; } }

    .footer{ margin-top: 14px; color: rgba(255,255,255,.45); font-size: 12px; text-align:center; }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.05);
      color: var(--muted);
      font-size: 12px;
      font-weight: 700;
      white-space: nowrap;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="brand">
        <div class="logo" aria-hidden="true">
          <svg width="26" height="26" viewBox="0 0 24 24" fill="none">
            <path d="M7 13.5V10.8C7 7.6 9.3 5 12 5s5 2.6 5 5.8v2.7"
              stroke="white" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 14.5c0-1.1.9-2 2-2h8c1.1 0 2 .9 2 2V18c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1v-3.5Z"
              stroke="white" stroke-width="2" stroke-linejoin="round"/>
            <path d="M12 9c.6.7.9 1.2.9 1.9 0 1-1 1.8-1.9 1.8S9.2 12 9.2 11c0-.9.7-1.6 1.5-2.3.6-.5.9-.9 1.3-1.7Z"
              fill="white" opacity=".9"/>
          </svg>
        </div>
        <div>
          <h1 class="title">Entretien du centre de secours de Consenvoye</h1>
          <p class="subtitle">P√©riode ‚Ä¢ Agent ‚Ä¢ Administrateur</p>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="cardBody">
        <div class="row two">
          <div>
            <label for="mois">Mois</label>
            <select id="mois">
              <option value="">-- S√©lectionner --</option>
              <option>Janvier</option><option>F√©vrier</option><option>Mars</option><option>Avril</option>
              <option>Mai</option><option>Juin</option><option>Juillet</option><option>Ao√ªt</option>
              <option>Septembre</option><option>Octobre</option><option>Novembre</option><option>D√©cembre</option>
            </select>
          </div>
          <div>
            <label for="annee">Ann√©e</label>
            <select id="annee">
              <option value="">-- S√©lectionner --</option>
              <option>2025</option>
              <option selected>2026</option>
              <option>2027</option>
            </select>
          </div>
        </div>
      </div>

      <div class="tabs" role="tablist" aria-label="Onglets">
        <div class="tab active" role="tab" aria-selected="true" onclick="showTab('agent')">üë®‚Äçüöí Agent</div>
        <div class="tab" role="tab" aria-selected="false" onclick="showTab('admin')">üõ°Ô∏è Administrateur</div>
      </div>

      <!-- AGENT -->
      <div id="agent" class="content active">
        <div class="section">
          <div class="sectionTitle">
            <span>Vue Agent</span>
            <span class="pill">Bient√¥t</span>
          </div>
          <!-- On remplira plus tard -->
          <div style="height:140px; border:1px dashed rgba(255,255,255,.16); border-radius:14px;"></div>
          <p class="hint">Cette partie sera affich√©e automatiquement √† partir des param√®tres Admin (agents + missions par p√©riode).</p>
        </div>
      </div>

      <!-- ADMIN -->
      <div id="admin" class="content">
        <div class="section">
          <div class="sectionTitle">
            <span>Acc√®s Administrateur</span>
            <span class="pill">Code requis</span>
          </div>

          <div class="lockRow">
            <input type="password" id="codeAdmin" placeholder="Code administrateur" />
            <button class="btn" style="max-width:220px;" onclick="unlockAdmin()">Acc√©der</button>
          </div>
          <p class="hint">Le code est dans le fichier (variable <b>ADMIN_CODE</b>). On le changera plus tard si tu veux.</p>
        </div>

        <div id="adminZone" style="display:none; margin-top:12px;">
          <!-- Agents -->
          <div class="section">
            <div class="sectionTitle">
              <span>Agents</span>
              <span class="pill" id="agentsCount">0</span>
            </div>

            <div class="row two">
              <div>
                <label for="agentNom">Ajouter un agent (Nom Pr√©nom)</label>
                <input id="agentNom" placeholder="Ex : V√âNANTE Pierre" />
              </div>
              <div style="display:flex; align-items:flex-end;">
                <button class="btn" onclick="addAgent()">Ajouter</button>
              </div>
            </div>

            <ul class="list" id="agentsList"></ul>

            <div class="inlineBtns" style="margin-top:10px;">
              <button class="btnGhost" onclick="exportData()">Exporter donn√©es</button>
              <button class="btnGhost" onclick="importData()">Importer donn√©es</button>
            </div>

            <p class="hint">
              Stockage actuel : <b>dans le navigateur</b> (localStorage). Sur un autre PC/t√©l√©phone ce sera vide.
              L‚Äôexport/import sert √† transporter les param√®tres.
            </p>
          </div>

          <!-- Missions par p√©riode -->
          <div class="section" style="margin-top:12px;">
            <div class="sectionTitle">
              <span>Missions par p√©riode</span>
              <span class="pill" id="periodPill">‚Äî</span>
            </div>

            <p class="hint" style="margin-top:0;">
              Choisis d‚Äôabord <b>Mois</b> et <b>Ann√©e</b> en haut, puis saisis les missions (une par ligne).
            </p>

            <div class="row">
              <div>
                <label for="missionsInput">Missions (1 par ligne)</label>
                <textarea id="missionsInput" placeholder="Ex :
Nettoyage des communs
Inventaire v√©hicules
Sortie poubelles / verre"></textarea>
              </div>
              <div class="inlineBtns">
                <button class="btn" onclick="saveMissions()">Enregistrer</button>
                <button class="btnGhost" onclick="loadMissions()">Charger</button>
              </div>
            </div>

            <ul class="list" id="missionsPreview"></ul>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">¬© Centre de secours ‚Ä¢ Prototype interne</div>
  </div>

  <script>
    // ======= CONFIG =======
    const ADMIN_CODE = "1234"; // change ici si tu veux

    const LS_KEY = "cs_consenvoye_entretien_v1";

    // ======= STATE =======
    const state = loadState();

    function loadState(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return { agents: [], missionsByPeriod: {} };
        const parsed = JSON.parse(raw);
        return {
          agents: Array.isArray(parsed.agents) ? parsed.agents : [],
          missionsByPeriod: parsed.missionsByPeriod && typeof parsed.missionsByPeriod === "object" ? parsed.missionsByPeriod : {}
        };
      }catch(e){
        return { agents: [], missionsByPeriod: {} };
      }
    }

    function saveState(){
      localStorage.setItem(LS_KEY, JSON.stringify(state));
      renderAgents();
      renderPeriodPill();
      renderMissionsPreview();
    }

    function periodKey(){
      const mois = document.getElementById("mois").value;
      const annee = document.getElementById("annee").value;
      if(!mois || !annee) return "";
      return `${annee}-${mois}`;
    }

    // ======= UI Tabs =======
    function showTab(tab) {
      const tabs = document.querySelectorAll('.tab');
      const contents = document.querySelectorAll('.content');

      tabs.forEach(t => { t.classList.remove('active'); t.setAttribute('aria-selected','false'); });
      contents.forEach(c => c.classList.remove('active'));

      if (tab === 'agent') {
        tabs[0].classList.add('active'); tabs[0].setAttribute('aria-selected','true');
      } else {
        tabs[1].classList.add('active'); tabs[1].setAttribute('aria-selected','true');
      }
      document.getElementById(tab).classList.add('active');
    }

    // ======= Admin Lock =======
    function unlockAdmin(){
      const code = document.getElementById("codeAdmin").value;
      if(code === ADMIN_CODE){
        document.getElementById("adminZone").style.display = "block";
        renderAgents();
        renderPeriodPill();
        loadMissions(); // charge automatiquement la p√©riode s√©lectionn√©e si possible
      }else{
        alert("Code incorrect");
      }
    }

    // ======= Agents =======
    function normalizeName(s){
      return (s || "").trim().replace(/\s+/g, " ");
    }

    function addAgent(){
      const inp = document.getElementById("agentNom");
      const name = normalizeName(inp.value);
      if(!name) return;

      // √©viter doublons exacts
      if(state.agents.includes(name)){
        inp.value = "";
        return;
      }

      state.agents.push(name);
      state.agents.sort((a,b)=>a.localeCompare(b, "fr", { sensitivity:"base" }));
      inp.value = "";
      saveState();
    }

    function removeAgent(name){
      const idx = state.agents.indexOf(name);
      if(idx >= 0){
        state.agents.splice(idx,1);
        saveState();
      }
    }

    function renderAgents(){
      const ul = document.getElementById("agentsList");
      const badge = document.getElementById("agentsCount");
      ul.innerHTML = "";
      badge.textContent = String(state.agents.length);

      state.agents.forEach(name=>{
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `
          <span>${escapeHtml(name)}</span>
          <button class="smallBtn danger" type="button">Supprimer</button>
        `;
        li.querySelector("button").addEventListener("click", ()=>removeAgent(name));
        ul.appendChild(li);
      });
    }

    // ======= Missions by Period =======
    function renderPeriodPill(){
      const pill = document.getElementById("periodPill");
      const key = periodKey();
      pill.textContent = key ? key : "S√©lectionner mois + ann√©e";
    }

    function parseLines(text){
      return (text || "")
        .split(/\r?\n/)
        .map(s=>s.trim())
        .filter(Boolean);
    }

    function loadMissions(){
      const key = periodKey();
      renderPeriodPill();
      const ta = document.getElementById("missionsInput");
      if(!key){
        ta.value = "";
        renderMissionsPreview();
        return;
      }
      const arr = Array.isArray(state.missionsByPeriod[key]) ? state.missionsByPeriod[key] : [];
      ta.value = arr.join("\n");
      renderMissionsPreview();
    }

    function saveMissions(){
      const key = periodKey();
      if(!key){
        alert("S√©lectionne d'abord le mois et l'ann√©e.");
        return;
      }
      const ta = document.getElementById("missionsInput");
      const missions = parseLines(ta.value);

      // supprimer doublons en gardant l‚Äôordre
      const seen = new Set();
      const unique = [];
      for(const m of missions){
        if(!seen.has(m)){
          seen.add(m);
          unique.push(m);
        }
      }

      state.missionsByPeriod[key] = unique;
      saveState();
      alert("Missions enregistr√©es pour " + key);
    }

    function renderMissionsPreview(){
      const key = periodKey();
      const ul = document.getElementById("missionsPreview");
      ul.innerHTML = "";

      if(!key) return;

      const arr = Array.isArray(state.missionsByPeriod[key]) ? state.missionsByPeriod[key] : [];
      if(arr.length === 0) return;

      arr.forEach((m)=>{
        const li = document.createElement("li");
        li.className = "item";
        li.innerHTML = `<span>${escapeHtml(m)}</span>`;
        ul.appendChild(li);
      });
    }

    // ======= Export / Import =======
    function exportData(){
      const blob = new Blob([JSON.stringify(state, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "entretien-consenvoye-data.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }

    function importData(){
      const input = document.createElement("input");
      input.type = "file";
      input.accept = "application/json";
      input.onchange = () => {
        const file = input.files && input.files[0];
        if(!file) return;
        const reader = new FileReader();
        reader.onload = () => {
          try{
            const data = JSON.parse(reader.result);
            state.agents = Array.isArray(data.agents) ? data.agents : [];
            state.missionsByPeriod = data.missionsByPeriod && typeof data.missionsByPeriod === "object" ? data.missionsByPeriod : {};
            saveState();
            alert("Import OK");
          }catch(e){
            alert("Fichier invalide");
          }
        };
        reader.readAsText(file);
      };
      input.click();
    }

    // ======= Helpers =======
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    // ======= Events =======
    document.getElementById("mois").addEventListener("change", ()=>{
      renderPeriodPill();
      // si admin est d√©j√† ouvert, recharge les missions
      if(document.getElementById("adminZone").style.display === "block") loadMissions();
    });
    document.getElementById("annee").addEventListener("change", ()=>{
      renderPeriodPill();
      if(document.getElementById("adminZone").style.display === "block") loadMissions();
    });

    // init
    renderPeriodPill();
  </script>
</body>
</html>
